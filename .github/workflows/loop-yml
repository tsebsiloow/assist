name: run-assist-scripts

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: setup
        run: |
          npm init -y >/dev/null 2>&1
          npm install puppeteer

      - name: create runner
        run: |
          cat <<'JS' > run.js
          const puppeteer = require("puppeteer");

          (async () => {
            const browser = await puppeteer.launch({
              args: ["--no-sandbox", "--disable-setuid-sandbox"]
            });

            const page = await browser.newPage();

            while(true){
              console.log("run", new Date().toISOString());

              await page.goto("about:blank");

              await page.addScriptTag({url:"https://cdn.jsdelivr.net/gh/tsebsiloow/assist@main/JS-assist.js"});
              await page.addScriptTag({url:"https://cdn.jsdelivr.net/gh/tsebsiloow/assist@main/JS-static.js"});
              await page.addScriptTag({url:"https://cdn.jsdelivr.net/gh/tsebsiloow/assist@main/backend-assist.js"});

              await new Promise(r=>setTimeout(r,10000));
            }
          })();
          JS

      - name: run loop
        run: node run.js
